<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Student Management System</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container my-5">
  <h1 class="text-center mb-4">Student Management System</h1>

  <div class="row">
    <!-- Students Module -->
    <div class="col-md-4">
      <h3>Students</h3>
      <form id="studentForm">
        <input type="text" id="studentName" placeholder="Name" class="form-control mb-2" required>
        <input type="email" id="studentEmail" placeholder="Email" class="form-control mb-2" required>
        <input type="text" id="studentRoll" placeholder="Roll Number" class="form-control mb-2" required>
        <button type="submit" class="btn btn-primary w-100">Add Student</button>
      </form>
      <ul id="studentsList" class="list-group mt-3"></ul>
    </div>

    <!-- Courses Module -->
    <div class="col-md-4">
      <h3>Courses</h3>
      <form id="courseForm">
        <input type="text" id="courseName" placeholder="Course Name" class="form-control mb-2" required>
        <input type="text" id="courseCode" placeholder="Course Code" class="form-control mb-2" required>
        <button type="submit" class="btn btn-success w-100">Add Course</button>
      </form>
      <ul id="coursesList" class="list-group mt-3"></ul>
    </div>

    <!-- Enrollments Module -->
    <div class="col-md-4">
      <h3>Enrollments</h3>
      <form id="enrollmentForm">
        <select id="enrollStudent" class="form-select mb-2" required></select>
        <select id="enrollCourse" class="form-select mb-2" required></select>
        <button type="submit" class="btn btn-warning w-100">Enroll</button>
      </form>
      <ul id="enrollmentsList" class="list-group mt-3"></ul>
    </div>
  </div>
</div>

<script>
const api = '/';

async function fetchStudents() {
  const res = await fetch(api + 'students');
  const data = await res.json();
  const list = document.getElementById('studentsList');
  const select = document.getElementById('enrollStudent');
  list.innerHTML = '';
  select.innerHTML = '';
  data.forEach(s => {
    list.innerHTML += `<li class="list-group-item">${s.name} (${s.rollNumber})</li>`;
    select.innerHTML += `<option value="${s._id}">${s.name}</option>`;
  });
}

async function fetchCourses() {
  const res = await fetch(api + 'courses');
  const data = await res.json();
  const list = document.getElementById('coursesList');
  const select = document.getElementById('enrollCourse');
  list.innerHTML = '';
  select.innerHTML = '';
  data.forEach(c => {
    list.innerHTML += `<li class="list-group-item">${c.name} (${c.code})</li>`;
    select.innerHTML += `<option value="${c._id}">${c.name}</option>`;
  });
}

async function fetchEnrollments() {
  const res = await fetch(api + 'enrollments');
  const data = await res.json();
  const list = document.getElementById('enrollmentsList');
  list.innerHTML = '';
  data.forEach(e => {
    list.innerHTML += `<li class="list-group-item">${e.student.name} enrolled in ${e.course.name}</li>`;
  });
}

document.getElementById('studentForm').addEventListener('submit', async e => {
  e.preventDefault();
  await fetch(api + 'students', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      name: document.getElementById('studentName').value,
      email: document.getElementById('studentEmail').value,
      rollNumber: document.getElementById('studentRoll').value
    })
  });
  e.target.reset();
  fetchStudents();
});

document.getElementById('courseForm').addEventListener('submit', async e => {
  e.preventDefault();
  await fetch(api + 'courses', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      name: document.getElementById('courseName').value,
      code: document.getElementById('courseCode').value
    })
  });
  e.target.reset();
  fetchCourses();
});

document.getElementById('enrollmentForm').addEventListener('submit', async e => {
  e.preventDefault();
  await fetch(api + 'enrollments', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      student: document.getElementById('enrollStudent').value,
      course: document.getElementById('enrollCourse').value
    })
  });
  fetchEnrollments();
});

fetchStudents();
fetchCourses();
fetchEnrollments();
</script>
</body>
</html>
